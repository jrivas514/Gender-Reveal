<!-- build: v-final-en-male + big-countdown + img4-after-count + zoomPink -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gender Reveal — Landing</title>
<style>
  :root{
    --shake: 0px; /* 0px = sin shaking; usa 0.3px/0.7px para leve temblor */
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  }
  html,body{height:100%;margin:0;background:#000;color:#fff;overflow:hidden}

  /* Pista (la #3 queda visible antes del conteo; la #4 se usa después) */
  #runway-seq{position:fixed;inset:0;z-index:0;opacity:0;transition:opacity .4s ease;background:#000;overflow:hidden}
  #runway-seq.show{opacity:1}
  #runway-seq.fade-out{opacity:0;transition:opacity .8s ease}
  #runway-seq img{
    position:absolute;inset:0;width:100%;height:100%;object-fit:cover;
    opacity:0;transform:scale(1);transition:opacity .8s ease, transform 2.6s ease;
  }
  #runway-seq img.show{ opacity:1; animation:zoomIn 3.2s forwards, shakeSmall .45s infinite; }
  @keyframes zoomIn{from{transform:scale(1)}to{transform:scale(1.15)}}
  @keyframes shakeSmall{
    0%  {transform:translate(0,0) scale(1.05)}
    25% {transform:translate(calc(var(--shake)*-1), var(--shake)) scale(1.055)}
    50% {transform:translate(var(--shake), calc(var(--shake)*-1)) scale(1.06)}
    75% {transform:translate(calc(var(--shake)*-0.5), calc(var(--shake)*1)) scale(1.065)}
    100%{transform:translate(0,0) scale(1.07)}
  }
  .touchdown{animation:bump .7s ease-out}
  @keyframes bump{
    0%{transform:translateY(0) scale(1.15)}
    40%{transform:translateY(10px) scale(1.11)}
    70%{transform:translateY(-5px) scale(1.12)}
    100%{transform:translateY(0) scale(1.15)}
  }

  /* Tarjeta/botón de prueba */
  .card{
    width:92%;max-width:1000px;margin:auto;position:relative;z-index:10;
    background:rgba(255,255,255,.08);border-radius:20px;padding:28px;
    box-shadow:0 10px 30px rgba(0,0,0,.2);backdrop-filter:blur(6px);text-align:center;
    top:50%;transform:translateY(-50%);transition:opacity .6s ease, transform .6s ease;
  }
  .hide-out{opacity:0;transform:translateY(-50%) scale(.98);pointer-events:none}
  h1{margin:6px 0 4px;font-size:clamp(32px,6vw,64px)}
  .subtitle{opacity:.9;margin-bottom:18px}
  .countdown{display:flex;gap:12px;justify-content:center;margin:18px 0}
  .count-item{background:rgba(255,255,255,.14);padding:12px 18px;border-radius:12px;min-width:84px}
  .count-item .num{font-size:32px;font-weight:700}
  .count-item .label{font-size:14px;opacity:.9}
  .cta button{padding:10px 16px;border-radius:10px;border:0;cursor:pointer}

  /* Avión decorativo */
  .plane{width:140px;position:absolute;left:-200px;bottom:130px;opacity:0;transition:all 1s linear;z-index:5}
  .plane.takeoff{animation:takeoff 2s ease-in forwards}
  @keyframes takeoff{0%{left:10%;bottom:130px;opacity:1}100%{left:120%;bottom:60%;opacity:0}}

  /* Pinklandia con zoom-in al aparecer */
  #pinklandia-bg{
    position:fixed;inset:0;
    background:url("Image (4).jpeg") bottom center/cover no-repeat;
    opacity:0;transition:opacity 1.6s ease;z-index:1;
    transform: scale(1);
    transform-origin: center bottom;
    will-change: transform, opacity;
  }
  #pinklandia-bg.show{
    opacity:1;
    animation:
      panCity 20s linear infinite alternate,
      zoomPink 2.6s ease-out forwards;
  }
  @keyframes panCity{0%{background-position:bottom left}100%{background-position:bottom right}}
  @keyframes zoomPink{from{transform:scale(1)}to{transform:scale(1.15)}}

  /* Letrero final */
  #only-reveal{
    position:fixed;inset:0;z-index:20;display:flex;align-items:center;justify-content:center;
    opacity:0;transition:opacity 1s ease .2s;pointer-events:none;
  }
  #only-reveal.show{opacity:1}
  #only-reveal .title{
    font-size:clamp(48px,9vw,140px);
    font-weight:900;letter-spacing:.5px;
    color:#ffe6f2;text-shadow:0 8px 30px rgba(0,0,0,.55), 0 0 10px rgba(255,105,180,.35);
  }

  /* Overlay de cuenta 5-4-3-2-1 */
  #count-overlay{
    position:fixed;inset:0;z-index:19;display:none;align-items:center;justify-content:center;
    background:rgba(0,0,0,.12);
  }
  #count-overlay.show{display:flex}
  #count-num{
    font-size:clamp(72px,22vw,280px);
    font-weight:1000; line-height:1; letter-spacing:1px;
    text-shadow:0 10px 40px rgba(0,0,0,.55);
    opacity:0; transform:scale(.7);
  }
  .count-pop{animation:countPop 1s ease-out}
  @keyframes countPop{
    0%{opacity:0;transform:scale(.6)}
    20%{opacity:1;transform:scale(1.12)}
    80%{opacity:1;transform:scale(1)}
    100%{opacity:0;transform:scale(.9)}
  }

  /* Confetti (solo en el reveal) */
  canvas#confetti{position:fixed;inset:0;pointer-events:none;z-index:15}
</style>
</head>
<body>

  <!-- 4 imágenes (la #4 se reserva para después del conteo) -->
  <div id="runway-seq">
    <img id="frame0" alt="frame0"/>
    <img id="frame1" alt="frame1"/>
    <img id="frame2" alt="frame2"/>
    <img id="frame3" alt="frame3"/><!-- ⬅️ NO se usa antes del conteo -->
  </div>

  <!-- Sonidos -->
  <audio id="snd-ding"    src="seatbelt-ding.mp3" preload="auto"></audio>
  <audio id="snd-engine"  src="engine-loop.mp3"    preload="auto" loop></audio>
  <audio id="snd-wind"    src="wind-rumble.mp3"    preload="auto" loop></audio>
  <audio id="snd-touch"   src="touchdown-thump.mp3" preload="auto"></audio>
  <audio id="snd-reverse" src="reverse-thrust.mp3"  preload="auto"></audio>
  <audio id="snd-roar"    src="takeoff-roar.mp3"    preload="auto"></audio>
  <audio id="snd-crowd"   src="applause-cheer.mp3"  preload="auto"></audio>

  <!-- Fondo + Letrero + Countdown -->
  <div id="pinklandia-bg"></div>
  <div id="only-reveal"><div class="title">It's a Girl! 💖</div></div>
  <div id="count-overlay"><div id="count-num">5</div></div>

  <!-- Tarjeta de inicio -->
  <div class="card" id="card">
    <h1>Taking off to...?</h1>
    <div class="subtitle">Destination: <strong>Bluelandia</strong> or <strong>Pinklandia</strong></div>
    <div id="countdown" class="countdown">
      <div class="count-item"><div class="num" id="days">00</div><div class="label">Days</div></div>
      <div class="count-item"><div class="num" id="hours">00</div><div class="label">Hours</div></div>
      <div class="count-item"><div class="num" id="minutes">00</div><div class="label">Min</div></div>
      <div class="count-item"><div class="num" id="seconds">00</div><div class="label">Sec</div></div>
    </div>
    <svg class="plane" viewBox="0 0 64 64" aria-hidden="true">
      <g fill="#fff"><path d="M4 30 L52 18 L56 20 L28 34 L60 38 L56 40 L52 42 L4 30 Z"/>
      <rect x="2" y="30" width="6" height="2" fill="#fff"/></g>
    </svg>
    <div class="cta"><button id="manualTrigger">Simulate Takeoff (preview)</button></div>
  </div>

  <canvas id="confetti"></canvas>

<script>
  /* ======= Config ======= */
  const eventDate = new Date("2025-09-13T17:00:00");
  const frames = ["Image (1).jpeg","Image (2).jpeg","Image (3).jpeg","Image (4).jpeg"];
  frames.forEach((src,i)=>{document.getElementById("frame"+i).src=src;});

  const plane = document.querySelector('.plane');
  const card  = document.getElementById('card');
  const onlyReveal = document.getElementById('only-reveal');
  const pinkBG = document.getElementById('pinklandia-bg');

  /* ======= Sonidos ======= */
  const snd={
    ding:document.getElementById('snd-ding'),
    engine:document.getElementById('snd-engine'),
    wind:document.getElementById('snd-wind'),
    touch:document.getElementById('snd-touch'),
    reverse:document.getElementById('snd-reverse'),
    roar:document.getElementById('snd-roar'),
    crowd:document.getElementById('snd-crowd')
  };
  function play(a,vol=1){try{a.volume=vol;a.currentTime=0;a.play();}catch(e){}}
  function fadeOut(a,ms=1500){
    try{const step=50,dec=a.volume/(ms/step);
      const id=setInterval(()=>{a.volume=Math.max(0,a.volume-dec);if(a.volume<=0){a.pause();clearInterval(id)}},step);
    }catch(e){}
  }

  /* ======= Aplausos garantizados ======= */
  let AC=null, masterG=null;
  function ensureAC(){if(!AC){AC=new (window.AudioContext||window.webkitAudioContext)();masterG=AC.createGain();masterG.connect(AC.destination);}}
  function randomNoiseBuffer(len=0.18){const n=Math.floor(len*AC.sampleRate);const b=AC.createBuffer(1,n,AC.sampleRate);const d=b.getChannelData(0);for(let i=0;i<n;i++)d[i]=(Math.random()*2-1)*(1-i/n);return b;}
  function scheduleClap(t){const s=AC.createBufferSource();s.buffer=randomNoiseBuffer(0.12+Math.random()*0.06);const bp=AC.createBiquadFilter();bp.type='bandpass';bp.frequency.value=1800+Math.random()*1200;bp.Q.value=4;const g=AC.createGain();g.gain.setValueAtTime(0,t);g.gain.linearRampToValueAtTime(1,t+0.01);g.gain.exponentialRampToValueAtTime(0.001,t+0.2);s.connect(bp);bp.connect(g);g.connect(masterG);s.start(t);}
  function scheduleCheer(start,dur){const src=AC.createBufferSource();const n=AC.createBuffer(1,AC.sampleRate*dur,AC.sampleRate);const d=n.getChannelData(0);let a=0,b0=0;for(let i=0;i<d.length;i++){const w=Math.random()*2-1;a=0.997*a+w*0.03;b0=0.985*b0+a*0.08;d[i]=b0*0.3;}src.buffer=n;const g=AC.createGain();g.gain.setValueAtTime(0,start);g.gain.linearRampToValueAtTime(0.45,start+0.5);g.gain.linearRampToValueAtTime(0.0,start+dur);src.connect(g);g.connect(masterG);src.start(start);src.stop(start+dur+0.1);}
  function applauseFallback(ms=7000){
    ensureAC(); if(AC.state==='suspended') AC.resume();
    const now=AC.currentTime+0.02; const dur=ms/1000;
    scheduleCheer(now,dur);
    let t=now; while(t<now+dur){const burst=6+Math.floor(Math.random()*8);for(let i=0;i<burst;i++)scheduleClap(t+Math.random()*0.2);t+=0.35+Math.random()*0.4;}
  }
  function playApplauseGuaranteed(){
    if(snd.crowd && snd.crowd.src){
      const p=snd.crowd.play?.();
      if(p && typeof p.then==='function'){
        p.then(()=> setTimeout(()=> fadeOut(snd.crowd,1800), 7000))
         .catch(()=> applauseFallback(7000));
      }else{
        setTimeout(()=> fadeOut(snd.crowd,1800), 7000);
      }
    }else{
      applauseFallback(7000);
    }
  }

  /* ======= Countdown de la tarjeta ======= */
  const days=document.getElementById('days'),hours=document.getElementById('hours'),minutes=document.getElementById('minutes'),seconds=document.getElementById('seconds');
  function pad(n){return String(n).padStart(2,'0');}
  function tickCard(){
    const now=new Date();const diff=eventDate-now;
    if(diff<=0){ return; }
    const s=Math.floor(diff/1000)%60,m=Math.floor(diff/60000)%60,h=Math.floor(diff/3600000)%24,d=Math.floor(diff/86400000);
    days.textContent=pad(d);hours.textContent=pad(h);minutes.textContent=pad(m);seconds.textContent=pad(s);
  }
  const tmr=setInterval(tickCard,1000); tickCard();

  /* ======= Voz (masculina en inglés) ======= */
  speechSynthesis.getVoices();
  function runAfterVoices(cb){
    if (speechSynthesis.getVoices().length) cb();
    else speechSynthesis.addEventListener('voiceschanged', () => cb(), { once:true });
  }
  function pickMaleEnVoice(){
    const voices = speechSynthesis.getVoices();
    const preferred = /(Alex|Daniel|Matthew|James|George|Ryan|Male|Google UK English Male|Microsoft (David|Guy|Mark))/i;
    return voices.find(v => /^en(-|_|$)/i.test(v.lang) && preferred.test(v.name)) ||
           voices.find(v => /^en(-|_|$)/i.test(v.lang));
  }
  function speak(text, {rate=0.86, pitch=0.95}={}){
    return new Promise(res=>{
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "en-US"; u.rate = rate; u.pitch = pitch;
      const v = pickMaleEnVoice(); if(v) u.voice = v;
      u.onend = res; speechSynthesis.speak(u);
    });
  }

  /* ======= Capitán ======= */
  async function captainAnnouncement(){
    await speak("Ladies and gentlemen, this is your captain speaking. Welcome aboard.", {rate:0.84, pitch:0.95});
    await speak("We are ready for departure to Bluelandia, or Pinklandia.", {rate:0.84, pitch:0.95});
    await new Promise(r=>setTimeout(r,1200));
    play(snd.roar,0.9);
    await new Promise(r=>setTimeout(r,900));
    await speak("Landing in.", {rate:0.82, pitch:0.94});
  }

  /* ======= Gritos de reveal ======= */
  function speakReveal(){
    const say = (t, d=0, r=1.06, p=0.98)=> setTimeout(()=> speak(t,{rate:r,pitch:p}), d);
    say("It's a...", 0, 1.02, 0.96);
    say("Girl!", 380, 1.1, 1.0);
    say("Congratulations!", 1250, 1.04, 0.98);
    say("It's a girl!", 2000, 1.08, 0.98);
  }

  /* ======= Secuencia de aterrizaje (solo frames 0,1,2) ======= */
  function playLandingSequence(afterTouchdown){
    const seq=document.getElementById('runway-seq');
    seq.classList.add('show');
    try{ snd.engine.volume=.35; snd.engine.play(); }catch(e){}
    try{ snd.wind.volume=.45; snd.wind.play(); }catch(e){}
    play(snd.roar,.58);

    const preCountFrames = 3; // 0,1,2
    const times=[1600,2000,2300]; // ~5.9s total para 3 frames
    for(let i=0;i<preCountFrames;i++){
      const img=document.getElementById("frame"+i);
      const at = times.slice(0,i+1).reduce((a,b)=>a+b,0);
      setTimeout(()=>{
        document.querySelectorAll('#runway-seq img').forEach(el=>el.classList.remove('show'));
        img.classList.add('show');
        if(i===preCountFrames-1){
          img.classList.add('touchdown');
          setTimeout(()=>{
            play(snd.touch,.95);
            setTimeout(()=>play(snd.reverse,.9),150);
            afterTouchdown && afterTouchdown();
          },700);
        }
      }, at);
    }
  }

  /* ======= Parámetros de tiempos ======= */
  const COUNT_STEP_MS = 1000;          // 1s por número
  const HOLD_BEFORE_COUNTDOWN = 2500;  // pausa en pista ANTES del "5"
  const POST_IMAGE4_HOLD_MS = 1000;    // cuánto se muestra Image (4) ANTES del reveal
  const PINKLANDIA_DELAY_MS = 800;     // retardo antes de mostrar Pinklandia tras fundir la pista

  /* ======= Conteo 5-4-3-2-1 ======= */
  function startRevealCountdown(done){
    const overlay = document.getElementById('count-overlay');
    const numEl   = document.getElementById('count-num');
    overlay.classList.add('show');
    let n = 5;
    function tick(){
      numEl.textContent = n;
      numEl.classList.remove('count-pop'); void numEl.offsetWidth; // reflow
      numEl.classList.add('count-pop');
      if(n>1){ n--; setTimeout(tick, COUNT_STEP_MS); }
      else{
        setTimeout(()=>{
          overlay.classList.remove('show');
          done && done();
        }, COUNT_STEP_MS);
      }
    }
    tick();
  }

  /* ======= Mostrar imagen 4 y luego ir al reveal ======= */
  function showImage4ThenReveal(){
    const img4=document.getElementById('frame3');
    document.querySelectorAll('#runway-seq img').forEach(el=>el.classList.remove('show'));
    img4.classList.add('show','touchdown');
    setTimeout(showFinal, POST_IMAGE4_HOLD_MS);
  }

  /* ======= Confetti ======= */
  const confettiCanvas=document.getElementById('confetti');const ctx=confettiCanvas.getContext('2d');
  function resizeCanvas(){confettiCanvas.width=innerWidth;confettiCanvas.height=innerHeight;}
  resizeCanvas();addEventListener('resize',resizeCanvas);
  let confetti=[]; 
  function startConfetti(){
    confetti.length=0;
    for(let i=0;i<260;i++){
      confetti.push({x:Math.random()*confettiCanvas.width,y:Math.random()*confettiCanvas.height-confettiCanvas.height,r:Math.random()*6+4,d:Math.random()*20+10,color:"hsl("+(Math.random()*30+330)+",100%,70%)"});
    }
    requestAnimationFrame(draw);
  }
  function draw(){
    ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
    for(let i=0;i<confetti.length;i++){
      const c=confetti[i]; ctx.fillStyle=c.color; ctx.fillRect(c.x,c.y,c.r,c.r);
      c.y += c.d/20; if(c.y>confettiCanvas.height){ c.y=-10; c.x=Math.random()*confettiCanvas.width; }
    }
    requestAnimationFrame(draw);
  }

  /* ======= Reveal (Pinklandia + letrero + confetti) ======= */
  function showFinal(){
    document.getElementById('runway-seq').classList.add('fade-out');
    setTimeout(()=>{ pinkBG.classList.add('show'); }, PINKLANDIA_DELAY_MS);

    card.classList.add('hide-out');
    document.getElementById('only-reveal').classList.add('show');
    startConfetti();
    speakReveal();
    playApplauseGuaranteed();
    setTimeout(()=>{ try{ fadeOut(snd.wind,1200); fadeOut(snd.engine,1800); }catch(e){} }, 1500);
  }

  /* ======= Orquestación ======= */
  function trigger(){
    try{ ensureAC(); if(AC.state==='suspended') AC.resume(); }catch(e){}
    play(snd.ding,.9);
    captainAnnouncement();
    plane.classList.add('takeoff');
    setTimeout(()=>{
      plane.classList.remove('takeoff');
      // Touchdown en Image (3) → pausa → conteo → Image (4) → reveal
      playLandingSequence(()=> setTimeout(()=> startRevealCountdown(showImage4ThenReveal), HOLD_BEFORE_COUNTDOWN));
    }, 1600);
  }

  document.getElementById('manualTrigger').addEventListener('click', () => {
    // Carga de voces antes de iniciar
    if (speechSynthesis.getVoices().length) trigger();
    else speechSynthesis.addEventListener('voiceschanged', trigger, { once:true });
  });
</script>
</body>
</html>
